---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/infra.contrib.fluxcd.io/terraform_v1alpha2.json
apiVersion: infra.contrib.fluxcd.io/v1alpha2
kind: Terraform
metadata:
  name: minio
spec:
  suspend: false
  approvePlan: auto
  interval: 12h
  path: ./minio
  sourceRef:
    kind: GitRepository
    name: terraform-record
    namespace: flux-system
  backendConfig:
    customConfiguration: |
      backend "s3" {
        key = "minio/minio.tfstate"
        region = "us-west-004"
        endpoints = {
          s3 = "https://s3.us-west-004.backblazeb2.com"
        }

        skip_credentials_validation = true
        skip_requesting_account_id  = true
        skip_metadata_api_check     = true
        skip_region_validation      = true
        use_path_style              = true
        use_lockfile                = true
      }
  backendConfigsFrom:
    - kind: Secret
      name: tofu-controller-s3-backend
  varsFrom:
    - kind: Secret
      name: tofu-controller-doppler
